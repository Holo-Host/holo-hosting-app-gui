{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport React, { Children, Component, isValidElement } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport { reduxForm, getFormAsyncErrors, getFormSyncErrors, getFormSubmitErrors } from 'redux-form';\nimport { connect } from 'react-redux';\nimport { withRouter, Route } from 'react-router-dom';\nimport compose from 'recompose/compose';\nimport Divider from '@material-ui/core/Divider';\nimport Tabs from '@material-ui/core/Tabs';\nimport { withStyles, createStyles } from '@material-ui/core/styles';\nimport { getDefaultValues, translate, REDUX_FORM_NAME } from 'ra-core';\nimport Toolbar from './Toolbar';\nimport CardContentInner from '../layout/CardContentInner';\n\nvar styles = function styles(theme) {\n  return createStyles({\n    errorTabButton: {\n      color: theme.palette.error.main\n    }\n  });\n};\n\nvar sanitizeRestProps = function sanitizeRestProps(_a) {\n  var anyTouched = _a.anyTouched,\n      array = _a.array,\n      asyncBlurFields = _a.asyncBlurFields,\n      asyncValidate = _a.asyncValidate,\n      asyncValidating = _a.asyncValidating,\n      autofill = _a.autofill,\n      blur = _a.blur,\n      change = _a.change,\n      clearAsyncError = _a.clearAsyncError,\n      clearFields = _a.clearFields,\n      clearSubmit = _a.clearSubmit,\n      clearSubmitErrors = _a.clearSubmitErrors,\n      destroy = _a.destroy,\n      dirty = _a.dirty,\n      dispatch = _a.dispatch,\n      form = _a.form,\n      handleSubmit = _a.handleSubmit,\n      initialize = _a.initialize,\n      initialized = _a.initialized,\n      initialValues = _a.initialValues,\n      pristine = _a.pristine,\n      pure = _a.pure,\n      redirect = _a.redirect,\n      reset = _a.reset,\n      resetSection = _a.resetSection,\n      save = _a.save,\n      staticContext = _a.staticContext,\n      submit = _a.submit,\n      submitFailed = _a.submitFailed,\n      submitSucceeded = _a.submitSucceeded,\n      submitting = _a.submitting,\n      touch = _a.touch,\n      translate = _a.translate,\n      triggerSubmit = _a.triggerSubmit,\n      undoable = _a.undoable,\n      untouch = _a.untouch,\n      valid = _a.valid,\n      validate = _a.validate,\n      props = __rest(_a, [\"anyTouched\", \"array\", \"asyncBlurFields\", \"asyncValidate\", \"asyncValidating\", \"autofill\", \"blur\", \"change\", \"clearAsyncError\", \"clearFields\", \"clearSubmit\", \"clearSubmitErrors\", \"destroy\", \"dirty\", \"dispatch\", \"form\", \"handleSubmit\", \"initialize\", \"initialized\", \"initialValues\", \"pristine\", \"pure\", \"redirect\", \"reset\", \"resetSection\", \"save\", \"staticContext\", \"submit\", \"submitFailed\", \"submitSucceeded\", \"submitting\", \"touch\", \"translate\", \"triggerSubmit\", \"undoable\", \"untouch\", \"valid\", \"validate\"]);\n\n  return props;\n};\n\nvar getTabFullPath = function getTabFullPath(tab, index, baseUrl) {\n  return \"\" + baseUrl + (tab.props.path ? \"/\" + tab.props.path : index > 0 ? \"/\" + index : '');\n};\n\nvar TabbedForm =\n/** @class */\nfunction (_super) {\n  __extends(TabbedForm, _super);\n\n  function TabbedForm() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.handleSubmitWithRedirect = function (redirect) {\n      if (redirect === void 0) {\n        redirect = _this.props.redirect;\n      }\n\n      return _this.props.handleSubmit(function (values) {\n        return _this.props.save(values, redirect);\n      });\n    };\n\n    return _this;\n  }\n\n  TabbedForm.prototype.render = function () {\n    var _a = this.props,\n        basePath = _a.basePath,\n        children = _a.children,\n        className = _a.className,\n        _b = _a.classes,\n        classes = _b === void 0 ? {} : _b,\n        invalid = _a.invalid,\n        location = _a.location,\n        match = _a.match,\n        pristine = _a.pristine,\n        record = _a.record,\n        redirect = _a.redirect,\n        resource = _a.resource,\n        saving = _a.saving,\n        submitOnEnter = _a.submitOnEnter,\n        tabsWithErrors = _a.tabsWithErrors,\n        toolbar = _a.toolbar,\n        translate = _a.translate,\n        undoable = _a.undoable,\n        value = _a.value,\n        version = _a.version,\n        rest = __rest(_a, [\"basePath\", \"children\", \"className\", \"classes\", \"invalid\", \"location\", \"match\", \"pristine\", \"record\", \"redirect\", \"resource\", \"saving\", \"submitOnEnter\", \"tabsWithErrors\", \"toolbar\", \"translate\", \"undoable\", \"value\", \"version\"]);\n\n    var validTabPaths = Children.toArray(children).map(function (tab, index) {\n      return getTabFullPath(tab, index, match.url);\n    }); // This ensure we don't get warnings from material-ui Tabs component when\n    // the current location pathname targets a dynamically added Tab\n    // In the case the targeted Tab is not present at first render (when\n    // using permissions for example) we temporarily switch to the first\n    // available tab. The current location will be applied again on the\n    // first render containing the targeted tab. This is almost transparent\n    // for the user who may just see an short tab selection animation\n\n    var tabsValue = validTabPaths.includes(location.pathname) ? location.pathname : validTabPaths[0];\n    return React.createElement(\"form\", __assign({\n      className: classnames('tabbed-form', className),\n      key: version\n    }, sanitizeRestProps(rest)), React.createElement(Tabs // The location pathname will contain the page path including the current tab path\n    // so we can use it as a way to determine the current tab\n    , {\n      // The location pathname will contain the page path including the current tab path\n      // so we can use it as a way to determine the current tab\n      value: tabsValue,\n      indicatorColor: \"primary\"\n    }, Children.map(children, function (tab, index) {\n      if (!isValidElement(tab)) return null; // Builds the full tab tab which is the concatenation of the last matched route in the\n      // TabbedShowLayout hierarchy (ex: '/posts/create', '/posts/12', , '/posts/12/show')\n      // and the tab path.\n      // This will be used as the Tab's value\n\n      var tabPath = getTabFullPath(tab, index, match.url);\n      return React.cloneElement(tab, {\n        context: 'header',\n        value: tabPath,\n        className: tabsWithErrors.includes(tab.props.label) && location.pathname !== tabPath ? classes.errorTabButton : null\n      });\n    })), React.createElement(Divider, null), React.createElement(CardContentInner, null, Children.map(children, function (tab, index) {\n      return tab && React.createElement(Route, {\n        exact: true,\n        path: getTabFullPath(tab, index, match.url)\n      }, function (routeProps) {\n        return isValidElement(tab) ? React.cloneElement(tab, {\n          context: 'content',\n          resource: resource,\n          record: record,\n          basePath: basePath,\n          hidden: !routeProps.match,\n\n          /**\n           * Force redraw when the tab becomes active\n           *\n           * This is because the fields, decorated by redux-form and connect,\n           * aren't redrawn by default when the tab becomes active.\n           * Unfortunately, some material-ui fields (like multiline TextField)\n           * compute their size based on the scrollHeight of a dummy DOM element,\n           * and scrollHeight is 0 in a hidden div. So they must be redrawn\n           * once the tab becomes active.\n           *\n           * @ref https://github.com/marmelab/react-admin/issues/1956\n           */\n          key: index + \"_\" + !routeProps.match\n        }) : null;\n      });\n    })), toolbar && React.cloneElement(toolbar, {\n      basePath: basePath,\n      className: 'toolbar',\n      handleSubmitWithRedirect: this.handleSubmitWithRedirect,\n      handleSubmit: this.props.handleSubmit,\n      invalid: invalid,\n      pristine: pristine,\n      record: record,\n      redirect: redirect,\n      resource: resource,\n      saving: saving,\n      submitOnEnter: submitOnEnter,\n      undoable: undoable\n    }));\n  };\n\n  return TabbedForm;\n}(Component);\n\nexport { TabbedForm };\nTabbedForm.propTypes = {\n  basePath: PropTypes.string,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  defaultValue: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  handleSubmit: PropTypes.func,\n  invalid: PropTypes.bool,\n  location: PropTypes.object,\n  match: PropTypes.object,\n  pristine: PropTypes.bool,\n  record: PropTypes.object,\n  redirect: PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.func]),\n  resource: PropTypes.string,\n  save: PropTypes.func,\n  saving: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n  submitOnEnter: PropTypes.bool,\n  tabsWithErrors: PropTypes.arrayOf(PropTypes.string),\n  toolbar: PropTypes.element,\n  translate: PropTypes.func,\n  undoable: PropTypes.bool,\n  validate: PropTypes.func,\n  value: PropTypes.number,\n  version: PropTypes.number\n};\nTabbedForm.defaultProps = {\n  submitOnEnter: true,\n  toolbar: React.createElement(Toolbar, null)\n};\n\nvar collectErrors = function collectErrors(state, props) {\n  var syncErrors = getFormSyncErrors(props.form)(state);\n  var asyncErrors = getFormAsyncErrors(props.form)(state);\n  var submitErrors = getFormSubmitErrors(props.form)(state);\n  return __assign({}, syncErrors, asyncErrors, submitErrors);\n};\n\nexport var findTabsWithErrors = function findTabsWithErrors(state, props, collectErrorsImpl) {\n  if (collectErrorsImpl === void 0) {\n    collectErrorsImpl = collectErrors;\n  }\n\n  var errors = collectErrorsImpl(state, props);\n  return Children.toArray(props.children).reduce(function (acc, child) {\n    if (!isValidElement(child)) {\n      return acc;\n    }\n\n    var inputs = Children.toArray(child.props.children);\n\n    if (inputs.some(function (input) {\n      return isValidElement(input) && errors[input.props.source];\n    })) {\n      return acc.concat([child.props.label]);\n    }\n\n    return acc;\n  }, []);\n};\nvar enhance = compose(withRouter, connect(function (state, props) {\n  var children = Children.toArray(props.children).reduce(function (acc, child) {\n    return acc.concat(isValidElement(child) ? Children.toArray(child.props.children) : []);\n  }, []);\n  return {\n    form: props.form || REDUX_FORM_NAME,\n    initialValues: getDefaultValues(state, __assign({}, props, {\n      children: children\n    })),\n    saving: props.saving || state.admin.saving,\n    tabsWithErrors: findTabsWithErrors(state, __assign({\n      form: REDUX_FORM_NAME\n    }, props))\n  };\n}), translate, // Must be before reduxForm so that it can be used in validation\nreduxForm({\n  destroyOnUnmount: false,\n  enableReinitialize: true,\n  keepDirtyOnReinitialize: true\n}), withStyles(styles));\nexport default enhance(TabbedForm);","map":null,"metadata":{},"sourceType":"module"}