{"ast":null,"code":"import _classCallCheck from \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/src/dashboard/Dashboard.js\";\nimport React, { Component } from 'react';\nimport { GET_LIST, GET_MANY, Responsive } from 'react-admin';\nimport Welcome from './Welcome';\nimport MonthlyRevenue from './MonthlyRevenue';\nimport NbNewOrders from './NbNewOrders';\nimport PendingOrders from './PendingOrders';\nimport PendingReviews from './PendingReviews';\nimport NewCustomers from './NewCustomers';\nimport dataProviderFactory from '../dataProvider';\nvar styles = {\n  flex: {\n    display: 'flex'\n  },\n  flexColumn: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  leftCol: {\n    flex: 1,\n    marginRight: '1em'\n  },\n  rightCol: {\n    flex: 1,\n    marginLeft: '1em'\n  },\n  singleCol: {\n    marginTop: '2em',\n    marginBottom: '2em'\n  }\n};\n\nvar Dashboard =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Dashboard, _Component);\n\n  function Dashboard() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Dashboard);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Dashboard)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {};\n    return _this;\n  }\n\n  _createClass(Dashboard, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var aMonthAgo = new Date();\n      aMonthAgo.setDate(aMonthAgo.getDate() - 30);\n      dataProviderFactory(process.env.REACT_APP_DATA_PROVIDER).then(function (dataProvider) {\n        dataProvider(GET_LIST, 'commands', {\n          filter: {\n            date_gte: aMonthAgo.toISOString()\n          },\n          sort: {\n            field: 'date',\n            order: 'DESC'\n          },\n          pagination: {\n            page: 1,\n            perPage: 50\n          }\n        }).then(function (response) {\n          return response.data.filter(function (order) {\n            return order.status !== 'cancelled';\n          }).reduce(function (stats, order) {\n            if (order.status !== 'cancelled') {\n              stats.revenue += order.total;\n              stats.nbNewOrders++;\n            }\n\n            if (order.status === 'ordered') {\n              stats.pendingOrders.push(order);\n            }\n\n            return stats;\n          }, {\n            revenue: 0,\n            nbNewOrders: 0,\n            pendingOrders: []\n          });\n        }).then(function (_ref) {\n          var revenue = _ref.revenue,\n              nbNewOrders = _ref.nbNewOrders,\n              pendingOrders = _ref.pendingOrders;\n\n          _this2.setState({\n            revenue: revenue.toLocaleString(undefined, {\n              style: 'currency',\n              currency: 'USD',\n              minimumFractionDigits: 0,\n              maximumFractionDigits: 0\n            }),\n            nbNewOrders: nbNewOrders,\n            pendingOrders: pendingOrders\n          });\n\n          return pendingOrders;\n        }).then(function (pendingOrders) {\n          return pendingOrders.map(function (order) {\n            return order.customer_id;\n          });\n        }).then(function (customerIds) {\n          return dataProvider(GET_MANY, 'customers', {\n            ids: customerIds\n          });\n        }).then(function (response) {\n          return response.data;\n        }).then(function (customers) {\n          return customers.reduce(function (prev, customer) {\n            prev[customer.id] = customer; // eslint-disable-line no-param-reassign\n\n            return prev;\n          }, {});\n        }).then(function (customers) {\n          return _this2.setState({\n            pendingOrdersCustomers: customers\n          });\n        });\n        dataProvider(GET_LIST, 'reviews', {\n          filter: {\n            status: 'pending'\n          },\n          sort: {\n            field: 'date',\n            order: 'DESC'\n          },\n          pagination: {\n            page: 1,\n            perPage: 100\n          }\n        }).then(function (response) {\n          return response.data;\n        }).then(function (reviews) {\n          var nbPendingReviews = reviews.reduce(function (nb) {\n            return ++nb;\n          }, 0);\n          var pendingReviews = reviews.slice(0, Math.min(10, reviews.length));\n\n          _this2.setState({\n            pendingReviews: pendingReviews,\n            nbPendingReviews: nbPendingReviews\n          });\n\n          return pendingReviews;\n        }).then(function (reviews) {\n          return reviews.map(function (review) {\n            return review.customer_id;\n          });\n        }).then(function (customerIds) {\n          return dataProvider(GET_MANY, 'customers', {\n            ids: customerIds\n          });\n        }).then(function (response) {\n          return response.data;\n        }).then(function (customers) {\n          return customers.reduce(function (prev, customer) {\n            prev[customer.id] = customer; // eslint-disable-line no-param-reassign\n\n            return prev;\n          }, {});\n        }).then(function (customers) {\n          return _this2.setState({\n            pendingReviewsCustomers: customers\n          });\n        });\n        dataProvider(GET_LIST, 'customers', {\n          filter: {\n            has_ordered: true,\n            first_seen_gte: aMonthAgo.toISOString()\n          },\n          sort: {\n            field: 'first_seen',\n            order: 'DESC'\n          },\n          pagination: {\n            page: 1,\n            perPage: 100\n          }\n        }).then(function (response) {\n          return response.data;\n        }).then(function (newCustomers) {\n          _this2.setState({\n            newCustomers: newCustomers\n          });\n\n          _this2.setState({\n            nbNewCustomers: newCustomers.reduce(function (nb) {\n              return ++nb;\n            }, 0)\n          });\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          nbNewCustomers = _this$state.nbNewCustomers,\n          nbNewOrders = _this$state.nbNewOrders,\n          nbPendingReviews = _this$state.nbPendingReviews,\n          newCustomers = _this$state.newCustomers,\n          pendingOrders = _this$state.pendingOrders,\n          pendingOrdersCustomers = _this$state.pendingOrdersCustomers,\n          pendingReviews = _this$state.pendingReviews,\n          pendingReviewsCustomers = _this$state.pendingReviewsCustomers,\n          revenue = _this$state.revenue;\n      return React.createElement(Responsive, {\n        xsmall: React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 153\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.flexColumn,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: {\n            marginBottom: '2em'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155\n          },\n          __self: this\n        }, React.createElement(Welcome, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 156\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.flex,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158\n          },\n          __self: this\n        }, React.createElement(MonthlyRevenue, {\n          value: revenue,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159\n          },\n          __self: this\n        }), React.createElement(NbNewOrders, {\n          value: nbNewOrders,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.singleCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, React.createElement(PendingOrders, {\n          orders: pendingOrders,\n          customers: pendingOrdersCustomers,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163\n          },\n          __self: this\n        })))),\n        small: React.createElement(\"div\", {\n          style: styles.flexColumn,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.singleCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        }, React.createElement(Welcome, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.flex,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, React.createElement(MonthlyRevenue, {\n          value: revenue,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }), React.createElement(NbNewOrders, {\n          value: nbNewOrders,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.singleCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }, React.createElement(PendingOrders, {\n          orders: pendingOrders,\n          customers: pendingOrdersCustomers,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }))),\n        medium: React.createElement(\"div\", {\n          style: styles.flex,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.leftCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.flex,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }, React.createElement(MonthlyRevenue, {\n          value: revenue,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        }), React.createElement(NbNewOrders, {\n          value: nbNewOrders,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.singleCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }, React.createElement(Welcome, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          style: styles.singleCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, React.createElement(PendingOrders, {\n          orders: pendingOrders,\n          customers: pendingOrdersCustomers,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          style: styles.rightCol,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          style: styles.flex,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 206\n          },\n          __self: this\n        }, React.createElement(PendingReviews, {\n          nb: nbPendingReviews,\n          reviews: pendingReviews,\n          customers: pendingReviewsCustomers,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207\n          },\n          __self: this\n        }), React.createElement(NewCustomers, {\n          nb: nbNewCustomers,\n          visitors: newCustomers,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212\n          },\n          __self: this\n        })))),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Dashboard;\n}(Component);\n\nexport default Dashboard;","map":{"version":3,"sources":["/home/lisa/Documents/gitrepos/holochain/holo/holo-hosting/No2_holo-hosting-app_GUI/holo-hosting-app_GUI/src/dashboard/Dashboard.js"],"names":["React","Component","GET_LIST","GET_MANY","Responsive","Welcome","MonthlyRevenue","NbNewOrders","PendingOrders","PendingReviews","NewCustomers","dataProviderFactory","styles","flex","display","flexColumn","flexDirection","leftCol","marginRight","rightCol","marginLeft","singleCol","marginTop","marginBottom","Dashboard","state","aMonthAgo","Date","setDate","getDate","process","env","REACT_APP_DATA_PROVIDER","then","dataProvider","filter","date_gte","toISOString","sort","field","order","pagination","page","perPage","response","data","status","reduce","stats","revenue","total","nbNewOrders","pendingOrders","push","setState","toLocaleString","undefined","style","currency","minimumFractionDigits","maximumFractionDigits","map","customer_id","customerIds","ids","customers","prev","customer","id","pendingOrdersCustomers","reviews","nbPendingReviews","nb","pendingReviews","slice","Math","min","length","review","pendingReviewsCustomers","has_ordered","first_seen_gte","newCustomers","nbNewCustomers"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { GET_LIST, GET_MANY, Responsive } from 'react-admin';\n\nimport Welcome from './Welcome';\nimport MonthlyRevenue from './MonthlyRevenue';\nimport NbNewOrders from './NbNewOrders';\nimport PendingOrders from './PendingOrders';\nimport PendingReviews from './PendingReviews';\nimport NewCustomers from './NewCustomers';\nimport dataProviderFactory from '../dataProvider';\n\nconst styles = {\n    flex: { display: 'flex' },\n    flexColumn: { display: 'flex', flexDirection: 'column' },\n    leftCol: { flex: 1, marginRight: '1em' },\n    rightCol: { flex: 1, marginLeft: '1em' },\n    singleCol: { marginTop: '2em', marginBottom: '2em' },\n};\n\nclass Dashboard extends Component {\n    state = {};\n\n    componentDidMount() {\n        const aMonthAgo = new Date();\n        aMonthAgo.setDate(aMonthAgo.getDate() - 30);\n\n        dataProviderFactory(process.env.REACT_APP_DATA_PROVIDER).then(\n            dataProvider => {\n                dataProvider(GET_LIST, 'commands', {\n                    filter: { date_gte: aMonthAgo.toISOString() },\n                    sort: { field: 'date', order: 'DESC' },\n                    pagination: { page: 1, perPage: 50 },\n                })\n                    .then(response =>\n                        response.data\n                            .filter(order => order.status !== 'cancelled')\n                            .reduce(\n                                (stats, order) => {\n                                    if (order.status !== 'cancelled') {\n                                        stats.revenue += order.total;\n                                        stats.nbNewOrders++;\n                                    }\n                                    if (order.status === 'ordered') {\n                                        stats.pendingOrders.push(order);\n                                    }\n                                    return stats;\n                                },\n                                {\n                                    revenue: 0,\n                                    nbNewOrders: 0,\n                                    pendingOrders: [],\n                                }\n                            )\n                    )\n                    .then(({ revenue, nbNewOrders, pendingOrders }) => {\n                        this.setState({\n                            revenue: revenue.toLocaleString(undefined, {\n                                style: 'currency',\n                                currency: 'USD',\n                                minimumFractionDigits: 0,\n                                maximumFractionDigits: 0,\n                            }),\n                            nbNewOrders,\n                            pendingOrders,\n                        });\n                        return pendingOrders;\n                    })\n                    .then(pendingOrders =>\n                        pendingOrders.map(order => order.customer_id)\n                    )\n                    .then(customerIds =>\n                        dataProvider(GET_MANY, 'customers', {\n                            ids: customerIds,\n                        })\n                    )\n                    .then(response => response.data)\n                    .then(customers =>\n                        customers.reduce((prev, customer) => {\n                            prev[customer.id] = customer; // eslint-disable-line no-param-reassign\n                            return prev;\n                        }, {})\n                    )\n                    .then(customers =>\n                        this.setState({ pendingOrdersCustomers: customers })\n                    );\n\n                dataProvider(GET_LIST, 'reviews', {\n                    filter: { status: 'pending' },\n                    sort: { field: 'date', order: 'DESC' },\n                    pagination: { page: 1, perPage: 100 },\n                })\n                    .then(response => response.data)\n                    .then(reviews => {\n                        const nbPendingReviews = reviews.reduce(nb => ++nb, 0);\n                        const pendingReviews = reviews.slice(\n                            0,\n                            Math.min(10, reviews.length)\n                        );\n                        this.setState({ pendingReviews, nbPendingReviews });\n                        return pendingReviews;\n                    })\n                    .then(reviews => reviews.map(review => review.customer_id))\n                    .then(customerIds =>\n                        dataProvider(GET_MANY, 'customers', {\n                            ids: customerIds,\n                        })\n                    )\n                    .then(response => response.data)\n                    .then(customers =>\n                        customers.reduce((prev, customer) => {\n                            prev[customer.id] = customer; // eslint-disable-line no-param-reassign\n                            return prev;\n                        }, {})\n                    )\n                    .then(customers =>\n                        this.setState({ pendingReviewsCustomers: customers })\n                    );\n\n                dataProvider(GET_LIST, 'customers', {\n                    filter: {\n                        has_ordered: true,\n                        first_seen_gte: aMonthAgo.toISOString(),\n                    },\n                    sort: { field: 'first_seen', order: 'DESC' },\n                    pagination: { page: 1, perPage: 100 },\n                })\n                    .then(response => response.data)\n                    .then(newCustomers => {\n                        this.setState({ newCustomers });\n                        this.setState({\n                            nbNewCustomers: newCustomers.reduce(nb => ++nb, 0),\n                        });\n                    });\n            }\n        );\n    }\n\n    render() {\n        const {\n            nbNewCustomers,\n            nbNewOrders,\n            nbPendingReviews,\n            newCustomers,\n            pendingOrders,\n            pendingOrdersCustomers,\n            pendingReviews,\n            pendingReviewsCustomers,\n            revenue,\n        } = this.state;\n        return (\n            <Responsive\n                xsmall={\n                    <div>\n                        <div style={styles.flexColumn}>\n                            <div style={{ marginBottom: '2em' }}>\n                                <Welcome />\n                            </div>\n                            <div style={styles.flex}>\n                                <MonthlyRevenue value={revenue} />\n                                <NbNewOrders value={nbNewOrders} />\n                            </div>\n                            <div style={styles.singleCol}>\n                                <PendingOrders\n                                    orders={pendingOrders}\n                                    customers={pendingOrdersCustomers}\n                                />\n                            </div>\n                        </div>\n                    </div>\n                }\n                small={\n                    <div style={styles.flexColumn}>\n                        <div style={styles.singleCol}>\n                            <Welcome />\n                        </div>\n                        <div style={styles.flex}>\n                            <MonthlyRevenue value={revenue} />\n                            <NbNewOrders value={nbNewOrders} />\n                        </div>\n                        <div style={styles.singleCol}>\n                            <PendingOrders\n                                orders={pendingOrders}\n                                customers={pendingOrdersCustomers}\n                            />\n                        </div>\n                    </div>\n                }\n                medium={\n                    <div style={styles.flex}>\n                        <div style={styles.leftCol}>\n                            <div style={styles.flex}>\n                                <MonthlyRevenue value={revenue} />\n                                <NbNewOrders value={nbNewOrders} />\n                            </div>\n                            <div style={styles.singleCol}>\n                                <Welcome />\n                            </div>\n                            <div style={styles.singleCol}>\n                                <PendingOrders\n                                    orders={pendingOrders}\n                                    customers={pendingOrdersCustomers}\n                                />\n                            </div>\n                        </div>\n                        <div style={styles.rightCol}>\n                            <div style={styles.flex}>\n                                <PendingReviews\n                                    nb={nbPendingReviews}\n                                    reviews={pendingReviews}\n                                    customers={pendingReviewsCustomers}\n                                />\n                                <NewCustomers\n                                    nb={nbNewCustomers}\n                                    visitors={newCustomers}\n                                />\n                            </div>\n                        </div>\n                    </div>\n                }\n            />\n        );\n    }\n}\n\nexport default Dashboard;\n"]},"metadata":{},"sourceType":"module"}