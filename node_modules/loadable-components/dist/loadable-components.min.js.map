{"version":3,"file":"loadable-components.min.js","sources":["../src/componentTracker.js","../src/constants.js","../src/utils/resolveModuleDefault.js","../src/loadable.js","../src/index.js","../src/loadComponents.js","../src/getState.js"],"sourcesContent":["let components = {}\n\nexport const track = (component, modules, index = 0) => {\n  let id = modules.join('-')\n  if (index) id += `-${index}`\n  if (components[id]) {\n    return track(component, modules, index + 1)\n  }\n  components[id] = component\n  return id\n}\n\nexport const get = id => components[id]\nexport const getAll = () => ({ ...components })\nexport const reset = () => {\n  components = {}\n}\n","export const LOADABLE_STATE = '__LOADABLE_STATE__'\nexport const LOADABLE = '@@loadable-components/loadable'\n","const resolveModuleDefault = module => module.default || module\n\nexport default resolveModuleDefault\n","/* eslint-disable react/sort-comp */\nimport React from 'react'\nimport hoistNonReactStatics from 'hoist-non-react-statics'\nimport { LOADABLE } from './constants'\nimport resolveModuleDefault from './utils/resolveModuleDefault'\nimport * as componentTracker from './componentTracker'\n\nconst EmptyComponent = () => null\n\nfunction loadable(\n  getComponent,\n  {\n    ErrorComponent = EmptyComponent,\n    LoadingComponent = EmptyComponent,\n    render,\n    modules,\n    asyncMode,\n  } = {},\n) {\n  class LoadableComponent extends React.Component {\n    static Component = null\n\n    static loadingPromise = null\n\n    static load() {\n      if (!LoadableComponent.loadingPromise) {\n        LoadableComponent.loadingPromise = getComponent()\n          .then(module => {\n            const Component = resolveModuleDefault(module)\n            LoadableComponent.Component = Component\n            hoistNonReactStatics(LoadableComponent, Component, {\n              Component: true,\n              loadingPromise: true,\n              load: true,\n              [LOADABLE]: true,\n              componentId: true,\n            })\n            return Component\n          })\n          .catch(error => {\n            LoadableComponent.loadingPromise = null\n            throw error\n          })\n      }\n\n      return LoadableComponent.loadingPromise\n    }\n\n    constructor(props) {\n      super(props)\n      this.state = {\n        Component: LoadableComponent.Component,\n        error: null,\n        loading: !LoadableComponent.Component,\n      }\n      this.mounted = false\n      this.loadingPromise = null\n\n      if (\n        typeof window !== 'undefined' &&\n        this.state.Component === null &&\n        this.loadingPromise === null\n      ) {\n        this.loadingPromise = LoadableComponent.load()\n          .then(Component => {\n            this.safeSetState({ Component, loading: false })\n          })\n          .catch(error => {\n            this.safeSetState({ error, loading: false })\n          })\n      }\n    }\n\n    componentDidMount() {\n      this.mounted = true\n    }\n\n    componentWillUnmount() {\n      this.mounted = false\n    }\n\n    safeSetState(state) {\n      if (!this.mounted) return\n      this.setState(state)\n    }\n\n    render() {\n      const { Component, error } = this.state\n\n      if (typeof render === 'function') {\n        return render({\n          ...this.state,\n          ownProps: this.props,\n        })\n      }\n\n      if (Component !== null) {\n        return <Component {...this.props} />\n      }\n\n      if (error !== null) {\n        return <ErrorComponent error={error} ownProps={this.props} />\n      }\n\n      if (asyncMode) {\n        throw this.loadingPromise\n      }\n\n      return <LoadingComponent {...this.props} />\n    }\n  }\n\n  LoadableComponent[LOADABLE] = () => LoadableComponent\n\n  if (modules) {\n    const id = componentTracker.track(LoadableComponent, modules)\n    LoadableComponent.componentId = id\n  }\n\n  return LoadableComponent\n}\n\nexport default loadable\n","import * as tracker from './componentTracker'\n\nexport { default as loadComponents } from './loadComponents'\nexport { default as getState } from './getState'\nexport { LOADABLE } from './constants'\nexport { default } from './loadable'\nexport const componentTracker = tracker\n","/* eslint-env browser */\nimport { LOADABLE, LOADABLE_STATE } from './constants'\nimport * as componentTracker from './componentTracker'\n\nfunction loadState(rootState) {\n  if (!rootState.children) return Promise.resolve(null)\n\n  return Promise.all(\n    rootState.children.map(state => {\n      const component = componentTracker.get(state.id)\n\n      if (!component) {\n        // eslint-disable-next-line\n        console.warn(\n          'loadable-component client modules:',\n          componentTracker.getAll(),\n        )\n        // eslint-disable-next-line\n        console.warn(\n          'loadable-component server modules:',\n          window[LOADABLE_STATE],\n        )\n\n        return Promise.reject(\n          new Error(\n            `loadable-components: module \"${\n              state.id\n            }\" is not found, client and server modules are not sync. You are probably not using the same resolver on server and client.`,\n          ),\n        )\n      }\n\n      const getLoadable = component[LOADABLE]\n\n      if (typeof getLoadable !== 'function') {\n        return Promise.reject(\n          new Error(\n            `loadable-components: module \"${\n              state.id\n            }\" is not a loadable component, please verify your SSR setup`,\n          ),\n        )\n      }\n\n      return getLoadable()\n        .load()\n        .then(() => loadState(state))\n    }),\n  )\n}\n\nfunction loadComponents() {\n  if (typeof window === 'undefined') {\n    return Promise.reject(\n      new Error(\n        'loadable-components: `loadComponents` must ' +\n          'be called client-side: `window` is undefined',\n      ),\n    )\n  }\n\n  const state = window[LOADABLE_STATE]\n  if (!state) {\n    return Promise.reject(\n      new Error(\n        'loadable-components state not found. ' +\n          'You have a problem server-side. ' +\n          'Please verify that you have called `loadableState.getScriptTag()` server-side.',\n      ),\n    )\n  }\n\n  return loadState(state)\n}\n\nexport default loadComponents\n","/* eslint-env browser */\n/* eslint-disable import/prefer-default-export */\nimport { getAll as getAllComponents } from './componentTracker'\nimport { LOADABLE_STATE } from './constants'\n\nfunction getState() {\n  const componentByIds = getAllComponents()\n  const children = Object.keys(componentByIds).reduce((ids, id) => {\n    const component = componentByIds[id]\n    if (component.loadingPromise) return [...ids, { id: component.componentId }]\n    return ids\n  }, [])\n  return { [LOADABLE_STATE]: { children } }\n}\n\nexport default getState\n"],"names":["components","track","component","modules","index","id","join","get","getAll","LOADABLE_STATE","LOADABLE","EmptyComponent","componentTracker","window","Promise","reject","Error","state","loadState","rootState","children","all","map","warn","getLoadable","load","then","resolve","componentByIds","getAllComponents","Object","keys","reduce","ids","loadingPromise","componentId","getComponent","ErrorComponent","LoadingComponent","render","asyncMode","LoadableComponent","props","_React$Component","Component","mounted","_this","safeSetState","loading","catch","error","module","default","componentDidMount","componentWillUnmount","this","setState","React","ownProps"],"mappings":"sjBAAIA,EAAa,GAEJC,EAAQ,SAARA,EAASC,EAAWC,OAASC,yDAAQ,EAC5CC,EAAKF,EAAQG,KAAK,YAClBF,IAAOC,OAAUD,GACjBJ,EAAWK,GACNJ,EAAMC,EAAWC,EAASC,EAAQ,MAEhCC,GAAMH,EACVG,IAGIE,EAAM,mBAAMP,EAAWK,IACvBG,EAAS,uBAAYR,ICbrBS,EAAiB,qBACjBC,EAAW,iCCDxB,ICOMC,EAAiB,kBAAM,UCDhBC,8CJQQ,aACN,4CKoCf,cACwB,oBAAXC,cACFC,QAAQC,OACb,IAAIC,MACF,gGAMAC,EAAQJ,OAAOJ,UAChBQ,EA1DP,SAASC,EAAUC,UACZA,EAAUC,SAERN,QAAQO,IACbF,EAAUC,SAASE,IAAI,gBACfpB,EAAYU,EAAqBK,EAAMZ,QAExCH,iBAEKqB,KACN,qCACAX,aAGMW,KACN,qCACAV,OAAOJ,IAGFK,QAAQC,OACb,IAAIC,sCAEAC,EAAMZ,sIAMRmB,EAActB,EAAUQ,SAEH,mBAAhBc,EACFV,QAAQC,OACb,IAAIC,sCAEAC,EAAMZ,mEAMPmB,IACJC,OACAC,KAAK,kBAAMR,EAAUD,QAzCIH,QAAQa,QAAQ,MAmEzCT,CAAUD,GATRH,QAAQC,OACb,IAAIC,MACF,oKC5DR,iBACQY,EAAiBC,IACjBT,EAAWU,OAAOC,KAAKH,GAAgBI,OAAO,SAACC,EAAK5B,OAClDH,EAAY0B,EAAevB,UAC7BH,EAAUgC,yBAA2BD,GAAK,CAAE5B,GAAIH,EAAUiC,eACvDF,GACN,iBACOxB,GAAiB,CAAEW,sCHH/B,SACEgB,gEAOI,OALFC,eAAAA,aAAiB1B,QACjB2B,iBAAAA,aAAmB3B,IACnB4B,IAAAA,OACApC,IAAAA,QACAqC,IAAAA,UAGIC,yBA6BQC,sRACVC,YAAMD,aACDzB,MAAQ,WACAwB,EAAkBG,gBACtB,cACGH,EAAkBG,aAEzBC,SAAU,IACVX,eAAiB,KAGF,oBAAXrB,QACkB,OAAzBiC,EAAK7B,MAAM2B,WACa,OAAxBE,EAAKZ,mBAEAA,eAAiBO,EAAkBhB,OACrCC,KAAK,cACCqB,aAAa,CAAEH,YAAWI,SAAS,MAEzCC,MAAM,cACAF,aAAa,CAAEG,QAAOF,SAAS,iVA5CrCvB,uBACAgB,EAAkBP,mBACHA,eAAiBE,IAChCV,KAAK,oBACEkB,KAAiCO,GD5BLC,SAAWD,WC6B3BP,UAAYA,IACTH,EAAmBG,kBAC3B,kBACK,QACV,IACLlC,IAAW,IACZyB,aAAa,MAERS,IAERK,MAAM,oBACaf,eAAiB,KAC7BgB,KAILT,EAAkBP,4BA4B3BmB,kCACOR,SAAU,eAGjBS,qCACOT,SAAU,eAGjBE,sBAAa9B,GACNsC,KAAKV,cACLW,SAASvC,gBAGhBsB,wBAC+BgB,KAAKtC,MAA1B2B,IAAAA,UAAWM,IAAAA,SAEG,mBAAXX,SACFA,OACFgB,KAAKtC,gBACEsC,KAAKb,YAID,OAAdE,SACKa,gBAACb,EAAcW,KAAKb,UAGf,OAAVQ,SACKO,gBAACpB,GAAea,MAAOA,EAAOQ,SAAUH,KAAKb,WAGlDF,QACIe,KAAKrB,sBAGNuB,gBAACnB,EAAqBiB,KAAKb,WAzFNe,EAAMb,gBAC7BA,UAAY,OAEZV,eAAiB,OA0FRxB,GAAY,kBAAM+B,GAEhCtC,EAAS,KACLE,EAAKO,EAAuB6B,EAAmBtC,KACnCgC,YAAc9B,SAG3BoC"}